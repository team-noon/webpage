import{r as o,j as d,f as te,g as ne,h as oe,i as se,k as ie,l as ce,E as ue,B as le,m as ae,n as de}from"./index-dnSyhVWS.js";function D(e,r){let t;return(...s)=>{window.clearTimeout(t),t=window.setTimeout(()=>e(...s),r)}}function fe({debounce:e,scroll:r,polyfill:t,offsetSize:s}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,l]=o.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),n=o.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u,orientationHandler:null}),p=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,w=o.useRef(!1);o.useEffect(()=>(w.current=!0,()=>void(w.current=!1)));const[R,g,f]=o.useMemo(()=>{const c=()=>{if(!n.current.element)return;const{left:z,top:j,width:P,height:x,bottom:L,right:H,x:M,y:B}=n.current.element.getBoundingClientRect(),a={left:z,top:j,width:P,height:x,bottom:L,right:H,x:M,y:B};n.current.element instanceof HTMLElement&&s&&(a.height=n.current.element.offsetHeight,a.width=n.current.element.offsetWidth),Object.freeze(a),w.current&&!me(n.current.lastBounds,a)&&l(n.current.lastBounds=a)};return[c,m?D(c,m):c,p?D(c,p):c]},[l,s,p,m]);function b(){n.current.scrollContainers&&(n.current.scrollContainers.forEach(c=>c.removeEventListener("scroll",f,!0)),n.current.scrollContainers=null),n.current.resizeObserver&&(n.current.resizeObserver.disconnect(),n.current.resizeObserver=null),n.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",n.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",n.current.orientationHandler))}function y(){n.current.element&&(n.current.resizeObserver=new i(f),n.current.resizeObserver.observe(n.current.element),r&&n.current.scrollContainers&&n.current.scrollContainers.forEach(c=>c.addEventListener("scroll",f,{capture:!0,passive:!0})),n.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",n.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",n.current.orientationHandler))}const O=c=>{!c||c===n.current.element||(b(),n.current.element=c,n.current.scrollContainers=G(c),y())};return ve(f,!!r),pe(g),o.useEffect(()=>{b(),y()},[r,f,g]),o.useEffect(()=>b,[]),[O,u,R]}function pe(e){o.useEffect(()=>{const r=e;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[e])}function ve(e,r){o.useEffect(()=>{if(r){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[e,r])}function G(e){const r=[];if(!e||e===document.body)return r;const{overflow:t,overflowX:s,overflowY:i}=window.getComputedStyle(e);return[t,s,i].some(u=>u==="auto"||u==="scroll")&&r.push(e),[...r,...G(e.parentElement)]}const he=["x","y","top","bottom","left","right","width","height"],me=(e,r)=>he.every(t=>e[t]===r[t]);var we=Object.defineProperty,be=Object.defineProperties,Ee=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,X=(e,r,t)=>r in e?we(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,A=(e,r)=>{for(var t in r||(r={}))ge.call(r,t)&&X(e,t,r[t]);if(N)for(var t of N(r))ye.call(r,t)&&X(e,t,r[t]);return e},xe=(e,r)=>be(e,Ee(r)),Y,V;typeof window<"u"&&((Y=window.document)!=null&&Y.createElement||((V=window.navigator)==null?void 0:V.product)==="ReactNative")?o.useLayoutEffect:o.useEffect;function J(e,r,t){if(!e)return;if(t(e)===!0)return e;let s=e.child;for(;s;){const i=J(s,r,t);if(i)return i;s=s.sibling}}function K(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const q=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=q;return}return q.apply(this,arguments)};const S=K(o.createContext(null));class Q extends o.Component{render(){return o.createElement(S.Provider,{value:this._reactInternals},this.props.children)}}function Ce(){const e=o.useContext(S);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const r=o.useId();return o.useMemo(()=>{for(const s of[e,e==null?void 0:e.alternate]){if(!s)continue;const i=J(s,!1,u=>{let l=u.memoizedState;for(;l;){if(l.memoizedState===r)return!0;l=l.next}});if(i)return i}},[e,r])}function _e(){const e=Ce(),[r]=o.useState(()=>new Map);r.clear();let t=e;for(;t;){if(t.type&&typeof t.type=="object"){const i=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;i&&i!==S&&!r.has(i)&&r.set(i,o.useContext(K(i)))}t=t.return}return r}function Re(){const e=_e();return o.useMemo(()=>Array.from(e.keys()).reduce((r,t)=>s=>o.createElement(r,null,o.createElement(t.Provider,xe(A({},s),{value:e.get(t)}))),r=>o.createElement(Q,A({},r))),[e])}const Oe=o.forwardRef(function({children:r,fallback:t,resize:s,style:i,gl:u,events:l=ie,eventSource:n,eventPrefix:p,shadows:m,linear:w,flat:R,legacy:g,orthographic:f,frameloop:b,dpr:y,performance:O,raycaster:c,camera:z,scene:j,onPointerMissed:P,onCreated:x,...L},H){o.useMemo(()=>te(de),[]);const M=Re(),[B,a]=fe({scroll:!0,debounce:{scroll:50,resize:0},...s}),C=o.useRef(null),F=o.useRef(null);o.useImperativeHandle(H,()=>C.current);const k=ne(P),[I,U]=o.useState(!1),[T,Z]=o.useState(!1);if(I)throw I;if(T)throw T;const _=o.useRef(null);oe(()=>{const E=C.current;a.width>0&&a.height>0&&E&&(_.current||(_.current=se(E)),_.current.configure({gl:u,events:l,shadows:m,linear:w,flat:R,legacy:g,orthographic:f,frameloop:b,dpr:y,performance:O,raycaster:c,camera:z,scene:j,size:a,onPointerMissed:(...v)=>k.current==null?void 0:k.current(...v),onCreated:v=>{v.events.connect==null||v.events.connect(n?ce(n)?n.current:n:F.current),p&&v.setEvents({compute:(W,h)=>{const ee=W[p+"X"],re=W[p+"Y"];h.pointer.set(ee/h.size.width*2-1,-(re/h.size.height)*2+1),h.raycaster.setFromCamera(h.pointer,h.camera)}}),x==null||x(v)}}),_.current.render(d.jsx(M,{children:d.jsx(ue,{set:Z,children:d.jsx(o.Suspense,{fallback:d.jsx(le,{set:U}),children:r??null})})})))}),o.useEffect(()=>{const E=C.current;if(E)return()=>ae(E)},[]);const $=n?"none":"auto";return d.jsx("div",{ref:F,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:$,...i},...L,children:d.jsx("div",{ref:B,style:{width:"100%",height:"100%"},children:d.jsx("canvas",{ref:C,style:{display:"block"},children:t})})})}),je=o.forwardRef(function(r,t){return d.jsx(Q,{children:d.jsx(Oe,{...r,ref:t})})});export{je as C};
